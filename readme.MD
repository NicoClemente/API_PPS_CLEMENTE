# ğŸ¬ FlixFinder API - Backend

## Proyecto Final de PrÃ¡ctica Profesional Supervisada (PPS)
**Universidad TecnolÃ³gica Nacional - FRBB**  
**Materia:** Laboratorio IV  
**Profesor:** SebastiÃ¡n GaÃ±an  
**Grupo 3:** Racciatti Carla, Mattei Stefano, Clemente NicolÃ¡s

---

## ğŸ“‹ DescripciÃ³n

API REST desarrollada con Node.js y Express que gestiona pelÃ­culas, series, actores y usuarios. El sistema implementa:

- âœ… Base de datos SQLite3 para persistencia
- âœ… Operaciones CRUD completas
- âœ… ProtecciÃ³n con API_KEY en todas las rutas
- âœ… IntegraciÃ³n con APIs externas (TMDb, TVMaze, OpenLibrary)
- âœ… Sistema de favoritos
- âœ… GestiÃ³n de usuarios

---

## ğŸš€ InstalaciÃ³n

### Requisitos previos
- Node.js v16 o superior
- npm o yarn

### Pasos de instalaciÃ³n

1. **Clonar el repositorio**
```bash
git clone [URL_DEL_REPO]
cd backend
```

2. **Instalar dependencias**
```bash
npm install
```

3. **Configurar variables de entorno**
```bash
cp .env.example .env
```

Editar el archivo `.env` con tus credenciales:
```env
PORT=3000
API_KEY=flixfinder_api_key_2024_grupo3_pps
TMDB_ACCESS_TOKEN=tu_token_aqui
```

4. **Iniciar el servidor**
```bash
# Modo desarrollo
npm run dev

# Modo producciÃ³n
npm start
```

La API estarÃ¡ disponible en `http://localhost:3000`

---

## ğŸ” AutenticaciÃ³n

**TODAS** las rutas `/api` requieren autenticaciÃ³n mediante API_KEY.

### MÃ©todos de envÃ­o:

**OpciÃ³n 1: Header (Recomendado)**
```bash
curl -H "X-API-KEY: flixfinder_api_key_2024_grupo3_pps" http://localhost:3000/api/v1/peliculas
```

**OpciÃ³n 2: Query Parameter**
```bash
curl http://localhost:3000/api/v1/peliculas?api_key=flixfinder_api_key_2024_grupo3_pps
```

---

## ğŸ“š Endpoints

### ğŸ¬ PelÃ­culas

#### Obtener pelÃ­culas populares (TMDb)
```http
GET /api/v1/peliculas
```

#### Buscar pelÃ­cula por tÃ­tulo
```http
GET /api/v1/peliculas/buscar?query=matrix
```

#### Filtrar por gÃ©nero
```http
GET /api/v1/peliculas/generos?genre=accion
```

#### Obtener lista de gÃ©neros
```http
GET /api/v1/peliculas/generos
```

#### Obtener pelÃ­cula por ID de TMDb
```http
GET /api/v1/peliculas/:id
```

#### **CRUD - Base de Datos Local**

##### Crear pelÃ­cula
```http
POST /api/v1/peliculas/db
Content-Type: application/json

{
  "tmdb_id": "550",
  "title": "El club de la lucha",
  "overview": "Un empleado de oficina...",
  "release_date": "1999-10-15",
  "vote_average": 8.4,
  "poster_path": "/path/to/poster.jpg",
  "genre_ids": [18, 53]
}
```

##### Obtener pelÃ­culas guardadas
```http
GET /api/v1/peliculas/db?page=1&limit=20
```

##### Obtener pelÃ­cula por ID local
```http
GET /api/v1/peliculas/db/:id
```

##### Actualizar pelÃ­cula
```http
PUT /api/v1/peliculas/db/:id
Content-Type: application/json

{
  "title": "Fight Club",
  "vote_average": 8.5
}
```

##### Eliminar pelÃ­cula
```http
DELETE /api/v1/peliculas/db/:id
```

---

### ğŸ“º Series

#### Obtener series (TVMaze)
```http
GET /api/v1/series?page=1
```

#### Buscar series
```http
GET /api/v1/series/buscar?query=breaking+bad
```

#### Filtrar por gÃ©nero
```http
GET /api/v1/series/genero?genre=drama
```

#### Obtener serie por ID de TVMaze
```http
GET /api/v1/series/:id
```

---

### ğŸ‘¤ Actores

#### Obtener actores populares (TMDb)
```http
GET /api/v1/actores?page=1&limit=50
```

#### Buscar actores por nombre
```http
GET /api/v1/actores/name?nombre=DiCaprio
```

#### Obtener actor por ID de TMDb
```http
GET /api/v1/actores/:id
```

---

### ğŸ‘¥ Usuarios

#### Crear usuario
```http
POST /api/v1/users
Content-Type: application/json

{
  "nombre": "Juan",
  "apellido": "PÃ©rez",
  "email": "juan@email.com",
  "telefono": "1234567890"
}
```

#### Obtener todos los usuarios
```http
GET /api/v1/users?page=1&limit=20
```

#### Obtener usuario por ID
```http
GET /api/v1/users/:id
```

#### Actualizar usuario
```http
PUT /api/v1/users/:id
Content-Type: application/json

{
  "nombre": "Juan Carlos",
  "telefono": "9876543210"
}
```

#### Eliminar usuario
```http
DELETE /api/v1/users/:id
```

---

### â­ Favoritos

#### Agregar a favoritos
```http
POST /api/v1/favorites
Content-Type: application/json

{
  "user_id": 1,
  "item_type": "movie",
  "item_id": 5
}
```
**item_type:** `movie`, `series` o `actor`

#### Obtener favoritos de un usuario
```http
GET /api/v1/favorites/user/:user_id
```

#### Obtener favoritos con detalles
```http
GET /api/v1/favorites/user/:user_id/detailed
```

#### Filtrar favoritos por tipo
```http
GET /api/v1/favorites/user/:user_id?type=movie
```

#### Eliminar favorito por ID
```http
DELETE /api/v1/favorites/:id
```

#### Eliminar favorito especÃ­fico
```http
DELETE /api/v1/favorites/remove
Content-Type: application/json

{
  "user_id": 1,
  "item_type": "movie",
  "item_id": 5
}
```

---

## ğŸ—„ï¸ Base de Datos

### Estructura

La base de datos SQLite3 incluye las siguientes tablas:

- **users** - Usuarios de la aplicaciÃ³n
- **movies** - PelÃ­culas guardadas
- **series** - Series guardadas
- **actors** - Actores guardados
- **favorites** - Favoritos de usuarios (relaciÃ³n polimÃ³rfica)

### Diagrama ER

Ver archivo `docs/DIAGRAMA_ER.md` para el diagrama completo.

### Schema SQL

El schema se encuentra en `database/schema.sql` y se carga automÃ¡ticamente al iniciar la aplicaciÃ³n.

---

## ğŸ“ Estructura del Proyecto

```
backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ database.js          # ConfiguraciÃ³n SQLite
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â”œâ”€â”€ movies_crud.js       # CRUD pelÃ­culas
â”‚   â”‚   â”œâ”€â”€ series.js            # Series
â”‚   â”‚   â”œâ”€â”€ actors.js            # Actores
â”‚   â”‚   â”œâ”€â”€ users.js             # Usuarios
â”‚   â”‚   â””â”€â”€ favorites.js         # Favoritos
â”‚   â”œâ”€â”€ middlewares/
â”‚   â”‚   â””â”€â”€ auth.js              # Middleware API_KEY
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ server.js            # Clase Server
â”‚   â””â”€â”€ routes/
â”‚       â”œâ”€â”€ movies.js
â”‚       â”œâ”€â”€ series.js
â”‚       â”œâ”€â”€ actors.js
â”‚       â”œâ”€â”€ users.js
â”‚       â””â”€â”€ favorites.js
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ schema.sql               # Schema de la BD
â”‚   â””â”€â”€ flixfinder.db            # Base de datos (se crea automÃ¡ticamente)
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ DIAGRAMA_ER.md           # Diagrama Entidad-RelaciÃ³n
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ .env.example                 # Ejemplo de variables de entorno
â”œâ”€â”€ .gitignore
â”œâ”€â”€ app.js                       # Punto de entrada
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

---

## ğŸ§ª Pruebas con Postman

### Importar ColecciÃ³n

1. Abrir Postman
2. Importar la colecciÃ³n desde `postman/FlixFinder_API.postman_collection.json`
3. Configurar la variable de entorno `API_KEY`

### Variables de Entorno

Crear un entorno en Postman con:
- `base_url`: `http://localhost:3000`
- `api_key`: `flixfinder_api_key_2024_grupo3_pps`

---

## ğŸ› ï¸ TecnologÃ­as Utilizadas

- **Node.js** - Runtime de JavaScript
- **Express** - Framework web
- **SQLite3** - Base de datos
- **Axios** - Cliente HTTP
- **CORS** - Control de acceso
- **dotenv** - Variables de entorno

---

## ğŸ“ Notas Importantes

### Sobre la API_KEY

- La API_KEY protege **TODAS** las rutas `/api`
- En producciÃ³n, cambiar por una clave mÃ¡s segura
- Nunca commitear el archivo `.env` al repositorio

### Sobre la Base de Datos

- La base de datos se crea automÃ¡ticamente en el primer inicio
- El archivo `flixfinder.db` se encuentra en `/database`
- Para resetear la BD, simplemente eliminar el archivo `.db`

### Sobre las APIs Externas

- **TMDb** requiere Access Token en `.env`
- **TVMaze** no requiere autenticaciÃ³n
- **OpenLibrary** no requiere autenticaciÃ³n

---

## ğŸ‘¥ Equipo de Desarrollo

- **Carla Racciatti** - Actores y Libros
- **Stefano Mattei** - Series
- **NicolÃ¡s Clemente** - PelÃ­culas

---

## ğŸ“„ Licencia

Proyecto acadÃ©mico - UTN FRBB 2024

---

## ğŸ“ Soporte

Para consultas sobre el proyecto, contactar al profesor SebastiÃ¡n GaÃ±an.